CREATE DATABASE BOLETO;
USE BOLETO;

CREATE TABLE CLIENTE
(
	NIT INTEGER NOT NULL PRIMARY KEY,
    NOMBRE VARCHAR(50) NOT NULL
);

CREATE TABLE GENERO 
(
	ID INTEGER NOT NULL PRIMARY KEY,
    DESCRIPCION VARCHAR(50) NOT NULL
);

CREATE TABLE PELICULA
(
	CODIGO VARCHAR(4) NOT NULL PRIMARY KEY,
    NOMBRE VARCHAR(50) NOT NULL,
    PRECIO INTEGER NOT NULL,
    IDGENERO INTEGER NOT NULL,
    FOREIGN KEY (IDGENERO)
		REFERENCES GENERO(ID)
		ON UPDATE CASCADE
        ON DELETE CASCADE
);

CREATE TABLE BOLETO
(
	NROB INTEGER NOT NULL PRIMARY KEY,
    FECHA DATETIME NOT NULL,
    NITCLIENTE INTEGER NOT NULL,
    MONTO INTEGER NOT NULL,
	CODPELICULA VARCHAR(4) NOT NULL,
    FOREIGN KEY(NITCLIENTE)
		REFERENCES CLIENTE(NIT)
        ON UPDATE CASCADE
        ON DELETE CASCADE,
	FOREIGN KEY(CODPELICULA)
		REFERENCES PELICULA(CODIGO)
        ON UPDATE CASCADE
        ON DELETE CASCADE
);

INSERT INTO CLIENTE (NIT, NOMBRE) VALUES
(111,	'Joaquin Chumacero'),
(222,'Saturnino Mamani');

INSERT INTO GENERO (ID, DESCRIPCION) VALUES
(1,	'DRAMA'),
(2,	'INFANTIL'),
(3,	'ACCION');

INSERT INTO PELICULA (CODIGO, NOMBRE, PRECIO, IDGENERO) VALUES
('P001',	'Duro de matar',	30,	3),
('P002',	'TITANIC',	40,	1),
('P003',	'RAMBO I',	30,	3),
('P004',	'REY LEON',	30,	2),
('P005',	'COCO',	30,	2);

INSERT INTO BOLETO (NROB, FECHA, NITCLIENTE, MONTO, CODPELICULA) VALUES
(100,	'2025-01-10',	111,	30,	'P001'),
(101,	'2025-01-10',	222,	30,	'P003'),
(102,	'2025-01-10',	111,	30,	'P005'),
(103,	'2025-01-15',	222,	30,	'P001');

/*
Consulta: MOSTRAR LOS CLIENTES QUE HAN VISTO 
ALGUNA PELICULA DEL GENERO ACCION, DONDE EL 
NOMBRE DE LA PELICULA  INICIE CON LA LETRA R
*/

SELECT NIT, NOMBRE
FROM CLIENTE
WHERE NIT IN 
(
	SELECT NITCLIENTE 
    FROM BOLETO, PELICULA, GENERO
    WHERE BOLETO.CODPELICULA = PELICULA.CODIGO
    AND PELICULA.IDGENERO = GENERO.ID
    AND GENERO.DESCRIPCION = 'ACCION'
);

/*
CONSULTA: MOSTRAR LA CANTIDAD DE PELICULAS 
DEL GENERO INFANTIL QUE NO HAN SIDO COMPRADOS 
EN NINGUN BOLETO (NO HAN SIDO VISTOS)
*/

SELECT COUNT(*) AS 'CANTIDAD DE PELICULAS INFANTIL NO COMPRADAS'
FROM PELICULA, GENERO
WHERE PELICULA.IDGENERO = GENERO.ID
AND GENERO.DESCRIPCION ='INFANTIL' 
AND CODIGO NOT IN 
(
	SELECT CODPELICULA
    FROM BOLETO
);

